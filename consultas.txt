'''Obtener PDF y timbre

     # Obtener PDF
    pdf = client_api.Facturacion.obtener_pdf(solicitud)
    # Guardar PDF
    with open("factura.pdf", "wb") as file:
        file.write(pdf)
    print("PDF guardado exitosamente", pdf)


-----------Timbre--------------------
        # Obtener timbre
    Timbre = client_api.Facturacion.obtener_timbre(solicitud)
    Timbre_data = json.loads(Timbre)
    if 'data' in Timbre_data:
        timbre_base64 = Timbre_data['data']
        timbre = base64.b64decode(timbre_base64)
        with open("timbre.png", "wb") as file:
            file.write(timbre)
        print("Timbre obtenido correctamente", timbre_base64)   
    else:
        print("Error al obtener timbre")




-------------------Obtener XML-------------------
 #OBTENER XML
    xml = client_api.Facturacion.obtener_xml(solicitud)
    ruta = "xml.xml"
    with open(ruta, "wb") as file:
        file.write(xml)
    print("XML guardado en:", ruta)


------------# Obtener DTE--------------
   solicitud_dict = solicitud.to_dict() 
    # Obtener DTE
    dte_bytes = client_api.Facturacion.obtener_dte(solicitud_dict)
    ruta = "dte.json"
    with open(ruta, "w", encoding="utf-8") as f:
        json.dump(dte_bytes, f, default=lambda o: o.__dict__, ensure_ascii=False)
    
    print("El DTE se ha descargado correctamente.", dte_bytes.folio)


-----------   # Obtener sobre XML----------
    # Obtener DTE
    sobre_xml_bytes = client_api.Facturacion.obtener_sobreXml(solicitud, 0)
    ruta = "sobre.xml"  # Ruta donde se guardará el sobre XML
    with open(ruta, "wb") as f:
        f.write(sobre_xml_bytes)
    print("El sobre XML se ha descargado correctamente.")


----------  # Facturación individual-----------
    
    Factura = client_api.Facturacion.facturacion_individualV2_Dte(solicitud, "Casa Matriz")
    print("\nDatos de la Respuesta:")
    print(f"Status: {Factura.status}")
    print(f"Message: {Factura.message}")
    print(f"TipoDTE: {Factura.data.tipoDTE}")
    print(f"RUT Emisor: {Factura.data.rutEmisor}")
    print(f"RUT Receptor: {Factura.data.rutReceptor}")
    print(f"Folio: {Factura.data.folio}")
    print(f"Fecha Emision: {Factura.data.fechaEmision}")
    print(f"Total: {Factura.data.total}")
    print(Factura.data)

------  # Facturación individual boletas--------
  def facturacion_individualV2_Boletas(self, solicitud, sucursal) -> InvoiceData:
        # Validar que la sucursal sea un string
        if not isinstance(sucursal, str):
            raise ValueError("El parámetro 'sucursal' debe ser un string.")
        url = f"{self.base_url}/invoiceV2/{sucursal}"
        solicitud_dict = serializar_solicitud_dict(solicitud)
        response = self.session.post(url, json=solicitud_dict)
        
        contenidoRespuesta = response.text        
        print("Respuesta completa:", contenidoRespuesta)
        
        if response.status_code == 200:
            response_json = response.json()
            deserialized_response = Response[InvoiceData].parse_raw(contenidoRespuesta)
            return deserialized_response
        else:
            raise Exception(f"Error en la petición: {contenidoRespuesta}")
            response.raise_for_status()  # Lanza una excepción para códigos de estado 4xx/5xx

----------      # Facturación individual Exportaciones-----------

    response = client_api.Facturacion.facturacion_individualV2_Exportacion(solicitud)
    ruta = "exportaciones.json"  # Ruta donde se guardará la factura
    with open(ruta, "wb") as f:
        f.write(response)

    print("La factura se ha descargado correctamente.")

----------EmisioNCND-------------
   Emision = client_api.Facturacion.EmisionNC_ND_V2(solicitud, "Casa Matriz", motivo)
    print("\nDatos de la Respuesta:")
    print(f"Status: {Emision.status}")
    print(f"Message: {Emision.message}")
    print(f"TipoDTE: {Emision.data.tipoDTE}")
    print(f"RUT Emisor: {Emision.data.rutEmisor}")
    print(f"RUT Receptor: {Emision.data.rutReceptor}")
    print(f"Folio: {Emision.data.folio}")
    print(f"Fecha Emision: {Emision.data.fechaEmision}")
    print(f"Total: {Emision.data.total}")
    print(Emision.data)


    
    